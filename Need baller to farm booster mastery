-- 先設置 GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- 文字框
local textBox = Instance.new("TextBox")
textBox.Size = UDim2.new(0, 200, 0, 50)
textBox.Position = UDim2.new(0, 100, 0, 100)
textBox.Text = "觸控移動文字框"
textBox.Parent = ScreenGui

-- 按鈕
local startButton = Instance.new("TextButton")
startButton.Size = UDim2.new(0, 200, 0, 50)
startButton.Position = UDim2.new(0, 100, 0, 200)
startButton.Text = "啟動腳本"
startButton.Parent = ScreenGui

-- 使文字框可觸控移動
local function makeDraggable(element)
    local dragToggle = false
    local dragInput
    local dragStart
    local startPos

    local function update(input)
        local delta = input.Position - dragStart
        element.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    element.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = true
            dragStart = input.Position
            startPos = element.Position
            input.Changed:Connect(function()
                if dragToggle then
                    update(input)
                end
            end)
        end
    end)

    element.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = false
        end
    end)
end

-- 使文字框和按鈕都可以拖動
makeDraggable(textBox)
makeDraggable(startButton)

-- 按鈕點擊事件
startButton.MouseButton1Click:Connect(function()
    local inputText = textBox.Text
    local combinedText = "\195\133Baller" .. inputText  -- 合併字符串

    for i = 1, 300 do
        -- 觸發 ClickDetector 事件，將玩家傳送到指定位置
        fireclickdetector(workspace.Lobby["Baller"].ClickDetector)

        -- 傳送玩家到 Workspace.Lobby.Teleport1
        local teleportPart = game:GetService("Workspace"):WaitForChild("Lobby"):FindFirstChild("Teleport1")

        if teleportPart and teleportPart:IsA("BasePart") then
            local player = game.Players.LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")

            -- 設定傳送位置，避免卡住
            hrp.CFrame = teleportPart.CFrame + Vector3.new(0, 5, 0)
        else
            warn("找不到指定部件：Lobby.Teleport1")
        end

        -- 等待 1 秒後觸發 GeneralAbility 事件
        wait(1)
        game:GetService("ReplicatedStorage"):WaitForChild("GeneralAbility"):FireServer()

        -- 發送 Reset 事件
        game:GetService("Players").LocalPlayer:WaitForChild("Reset"):FireServer()

        -- 等待 4 秒後觸發 Booster 的 ClickDetector
        wait(4)
        fireclickdetector(workspace.Lobby["Booster"].ClickDetector)

        -- 重複 2 次，間隔 1 秒
        for j = 1, 2 do
            wait(1)
            local args = {
                [1] = workspace:WaitForChild(combinedText):WaitForChild("Torso")
            }
            -- 觸發攻擊
            game:GetService("ReplicatedStorage"):WaitForChild("GeneralHit"):FireServer(unpack(args))
        end
    end
end)
